# =========================
# io.asm — низкоуровневые I/O-макросы для RARS RISC-V
# Здесь собраны макросы-обёртки над системными вызовами (ecall).
# Номера сервисов соответствуют таблице syscalls RARS:
# 1  — печать целого из a0
# 4  — печать строки по адресу a0 (null-terminated)
# 5  — чтение целого в a0
# 10 — завершение программы
# 11 — печать символа (код в a0)
# По соглашению: a0–a7 — аргументы/результат, ecall использует a7 как номер сервиса.
# =========================

.macro read_int (%register)
	# Считать целое число из консоли.
	# До вызова: ничего
	# После вызова: в %register — прочитанное значение (копия из a0)
	li a7 5           # сервис 5: read_int
	ecall
	mv %register a0   # перенести результат в указанный регистр
.end_macro

.macro print_str (%string)
   # Напечатать строковый литерал (C-строка с завершающим нулём).
   # макрос объявляет метку 'str' в .data при каждом разворачивании.
   # В реальном коде лучше использовать уникальные имена; здесь оставляем как есть.
   .data
	str: .asciz %string
   .text
       li a7, 4       # сервис 4: print_string
       la a0, str     # a0 ? адрес строки
       ecall
.end_macro

.macro print_from_adress (%adr)
	# Напечатать строку, адрес которой уже есть (нулём-терминированная).
	li a7 4           # сервис 4: print_string
	mv a0 %adr        # a0 ? адрес
	ecall
.end_macro

.macro print_int_from_register(%register)
    # Напечатать целое из указанного регистра.
    mv a0 %register   # a0 ? значение
    li a7 1           # сервис 1: print_int
    ecall
.end_macro

.macro print_char(%char)
   # Напечатать одиночный символ с заданным кодом.
   li a7, 11          # сервис 11: print_char
   li a0, %char       # a0 ? код символа
   ecall
.end_macro

.macro newline
   # Перевод строки — удобно для форматирования вывода.
   print_char('\n')
.end_macro

.macro register_to_a0 (%reg)
	# Скопировать слово из произвольного регистра в a0 (унификация интерфейса).
	mv a0 %reg
.end_macro

.macro exit
    # Корректное завершение программы.
    li a7, 10         # сервис 10: exit
    ecall
.end_macro
