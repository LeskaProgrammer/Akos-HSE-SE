# Отчёт по ДЗ №7  
Копирование файлов через системные вызовы

Я: Симонов Алексей
Группа:  248
Файл программы: `main.cpp`

---

## 1. Цель работы

Реализовать консольную утилиту `hw7_copy`, которая копирует содержимое одного файла в другой, используя только системные вызовы (`stat`, `open`, `read`, `write`, `close`, `chmod`), и поддерживает два режима копирования:
- основной режим с буфером, **строго превышающим размер файла**;
- режим с маленьким буфером размером 32 байта.

---

## 2. Формат запуска

Команда запуска:

`./hw7_copy <src> <dst> [--small | -s]`

где  
`<src>` — путь к исходному файлу;  
`<dst>` — путь к целевому файлу;  
`--small` или `-s` — включить режим маленького буфера (32 байта).

При неверных аргументах программа выводит сообщение вида `"Usage: <prog> <src> <dst> [-s|--small]"`.

---

## 3. Краткое описание работы программы

1. С помощью `stat` программа получает размер и права доступа исходного файла.  
2. Исходный файл открывается на чтение (`open` с `O_RDONLY`), целевой — на запись/создание (`O_WRONLY | O_CREAT | O_TRUNC`) с теми же правами доступа, что у исходного (маска `0777` из `st_mode`).  
3. В зависимости от флага:
   - **без флага**: выделяется динамический буфер размера `file_size + 1`, файл целиком считывается в память и затем полностью записывается в целевой файл (с учётом частичных записей `write`);
   - **с флагом `--small` / `-s`**: используется стековый буфер `32` байта, данные копируются в цикле `read → write` до достижения конца файла.  
4. После копирования дополнительно вызывается `chmod`, чтобы целевой файл получил те же права, что исходный.  
5. Файловые дескрипторы закрываются через `close`; при любых ошибках чтения/записи/открытия/закрытия выводятся сообщения с текстом `strerror(errno)`. При успехе программа возвращает `0`, при ошибке — `1`.

---

## 4. Соответствие требованиям и оценка

Выполнено:

- использование только системных вызовов для работы с файлами;
- буфер, строго больше размера файла, в основном режиме;
- альтернативный режим с маленьким буфером 32 байта;
- сохранение прав доступа исходного файла при копировании;
- корректная обработка ошибок и вывод понятных сообщений.

Ожидаемая оценка: **8/8 баллов (100/100)**.
