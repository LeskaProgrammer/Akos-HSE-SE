# IHW_3 — симуляция картинной галереи (SysV shared memory + семафоры)

## Состав репозитория

- `gallery_common.h` — общие структуры, константы и ключи IPC.
- `gallery_init.c` — инициализация разделяемой памяти и семафоров, задание числа посетителей.
- `gallery_guard.c` — «охранник», периодически печатает сводку по залу и картинам.
- `gallery_monitor.c` — «монитор», который дублирует весь вывод остальных процессов.
- `gallery_visitor.c` — процессы-посетители: входят в галерею, ходят между картинами и выходят.

Собранные исполняемые файлы: `gallery_init`, `gallery_guard`, `gallery_monitor`, `gallery_visitor`.

## Сборка и запуск

Из каталога `IHW_3`:

    wsl          # перейти в WSL
    make         # сборка и запуск сценария

Команда `make`:

1. компилирует все .c-файлы в исполняемые файлы;
2. запускает демонстрационный сценарий на 30 посетителей:

    ./gallery_init 30
    ./gallery_guard &
    for i in $(seq 1 30); do ./gallery_visitor $i & done
    ./gallery_monitor

Повторный вызов `make` без изменений в исходниках приводит к сообщению:

    make: Nothing to be done for 'all'.

## Пример запуска (фрагмент отчёта)

    PS C:\Users\lesha\Desktop\IHW_3> wsl
    wsl: Конфигурация прокси-сервера localhost обнаружена, но не отражена в WSL. WSL в режиме NAT не поддерживает прокси-серверы localhost.
    lesha@DESKTOP-UVM8PF1:/mnt/c/Users/lesha/Desktop/IHW_3$ make
    ./gallery_init 30
    ./gallery_guard &
    for i in $(seq 1 30); do ./gallery_visitor $i & done
    ./gallery_monitor
    make: Nothing to be done for 'all'.
    Инициализация завершена: ожидается 30 посетителей.
    [1]  450
    [2]  452
    [3]  453
    ...
    [VISITOR 27] вышел из галереи. Внутри 0, завершило 30 из 30
    [MONITOR 482] [VISITOR 27] вышел из галереи. Внутри 0, завершило 30 из 30
    [GUARD 0] контроль: внутри 0, завершило 30 из 30
    [GUARD 0] картина 0: возле нее 0 посетителей
    [GUARD 0] картина 1: возле нее 0 посетителей
    [GUARD 0] картина 2: возле нее 0 посетителей
    [GUARD 0] картина 3: возле нее 0 посетителей
    [GUARD 0] картина 4: возле нее 0 посетителей
    [GUARD 0] день окончен, галерея закрывается
    [MONITOR 482] [GUARD 0] день окончен, галерея закрывается
    [1]   Done                    ./gallery_guard
    [2]   Done                    ./gallery_visitor $i
    ...
    [31]+ Done                    ./gallery_visitor $i
    lesha@DESKTOP-UVM8PF1:/mnt/c/Users/lesha/Desktop/IHW_3$

(В середине вывода часть строк опущена для краткости.)

## Краткий разбор вывода

- `make` собирает все исполняемые файлы и запускает демонстрационный сценарий.
- `gallery_init 30` создаёт разделяемую память и семафоры и задаёт 30 ожидаемых посетителей.
- Запускается один `gallery_guard`, 30 процессов `gallery_visitor` и один `gallery_monitor`.
- В логе видно:
  - вход посетителей в галерею и подходы к картинам с учётом ограничений по числу людей;
  - периодические отчёты `GUARD` о числе людей в зале и около каждой картины;
  - дублирование всех событий процессом `MONITOR`;
  - корректное завершение всех 30 посетителей и закрытие галереи.

После завершения всех процессов управление возвращается в оболочку WSL.
